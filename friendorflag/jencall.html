<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Call | Friend or Flag</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Quicksand', sans-serif; }

        body {
            background: linear-gradient(135deg, #CFBCFF 0%, #E3D9FF 99%, #E3D9FF 100%);
            height: 100vh;
            display: flex; justify-content: center; align-items: center;
            overflow: hidden; position: relative;
        }

        /* --- DESKTOP ICONS (Consistent with Start Page) --- */
        .desktop-icons { 
            position: absolute; top: 15px; left: 15px; 
            display: flex; flex-direction: column; gap: 15px; 
            opacity: 0.8; 
        }
        .icon-item { display: flex; flex-direction: column; align-items: center; gap: 3px; }
        .icon-box { 
            width: 40px; height: 40px; border-radius: 10px; 
            display: flex; justify-content: center; align-items: center; font-size: 20px; 
        }
        .icon-photos { background: linear-gradient(to bottom, #FFF9E3, #FFF3B0); }
        .icon-chrome { background: linear-gradient(to bottom, #A2D2FF, #BDE0FE); }
        .icon-label { color: white; font-size: 10px; font-weight: 600; text-shadow: 0 1px 3px rgba(0,0,0,0.3); }

        /* --- CALL WINDOW (Resized & Pop-In Effect) --- */
        .call-window {
            width: 320px; height: 480px; /* Reduced to fit 540px height comfortably */
            background: white; border-radius: 24px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            z-index: 10; overflow: hidden;
            border: 3px solid #D1D9E6; 
            display: flex; flex-direction: column; position: relative;
            transition: width 0.8s cubic-bezier(0.19, 1, 0.22, 1), transform 0.6s ease-in-out, border-color 0.8s;
            /* Combined Pop-In and Float */
            animation: popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .call-window.ongoing {
            width: 780px; /* Reduced from 850px to fit 960px width */
            border-color: #C3C7D1; 
            animation: floatCall 4s infinite ease-in-out; 
        }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes floatCall {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* --- WINDOW HEADER --- */
        .window-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 8px 12px; background: #F0F2F5; border-bottom: 2px solid #D1D9E6;
        }
        .window-controls { display: flex; gap: 6px; width: 50px; }
        .header-title {
            color: #9BA5B4; font-weight: 700; font-size: 10px;
            text-transform: uppercase; letter-spacing: 1px; flex: 1; text-align: center;
        }
        .control { width: 10px; height: 10px; border-radius: 50%; }
        .red { background-color: #FF5F56; }
        .yellow { background-color: #FFBD2E; }
        .green { background-color: #27C93F; }

        /* --- INCOMING VIEW --- */
        #incomingView {
            flex: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center; background: white;
            transition: opacity 0.4s ease;
        }
        .jen-avatar {
            width: 120px; height: 120px; border-radius: 50%;
            border: 5px solid #F0F4F8; margin-bottom: 15px;
            background: url('jenincall.jpg') center/cover;
            background-position: center 20%; /* Show more of top */
        }
        .call-btns-row { display: flex; gap: 30px; margin-top: 20px; }
        .btn-large {
            width: 60px; height: 60px; border-radius: 50%; border: none;
            color: white; font-size: 20px; cursor: pointer; display: flex;
            align-items: center; justify-content: center; transition: 0.3s;
        }
        .decline-btn { background: #FFB7B2; cursor: not-allowed; }
        .accept-btn { background: #B2E2A2; }
        .accept-btn:hover { transform: scale(1.1); background: #96D183; }

        /* --- VIDEO VIEW --- */
        #videoView { 
            display: none; flex: 1; position: relative; background: #000; flex-direction: column;
            opacity: 0; transition: opacity 0.8s ease-in;
        }
        #jenVideoFrame { 
            flex: 1; 
            background-size: cover; 
            background-position: center 15%; /* Show more of top of Jen's head */
            transition: background-image 0.5s ease-in-out; 
        }
        .user-mini-cam {
            position: absolute; top: 15px; right: 15px;
            width: 140px; height: 90px; border-radius: 12px;
            border: 2px solid #D1D9E6; overflow: hidden; background: #333;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        #userCam { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }

        /* --- DIALOGUE BOX --- */
        .dialogue-overlay {
            position: absolute; bottom: 85px; left: 50%;
            transform: translateX(-50%); width: 85%;
            background: rgba(255, 255, 255, 0.96);
            border: 3px solid #FFD1DC; border-radius: 18px;
            padding: 15px 25px; cursor: pointer; z-index: 20;
        }
        .name-tag {
            position: absolute; top: -15px; left: 15px;
            background: #FFB7C5; color: white; padding: 3px 20px;
            border-radius: 12px; font-weight: 700; font-size: 12px;
        }
        .dialogue-text { color: #E08295; font-size: 15px; font-weight: 600; line-height: 1.4; }

        /* --- FOOTER BUTTONS --- */
        .video-footer {
            height: 70px; background: white;
            display: flex; justify-content: center; align-items: center; gap: 20px;
            border-top: 2px solid #D1D9E6;
        }
        .v-btn {
            width: 40px; height: 40px; border-radius: 50%; border: none;
            background: #E6E9EF; color: #9BA5B4; font-size: 16px; cursor: pointer;
        }
        .v-btn.end { background: #FFB7B2; color: white; cursor: not-allowed; }

        /* --- CLOCK OVERLAY --- */
        #clockOverlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(230, 235, 245, 0.95);
            display: none; flex-direction: column; justify-content: center; align-items: center;
            z-index: 50;
        }
        .clock { width: 80px; height: 80px; border: 6px solid #9BA5B4; border-radius: 50%; position: relative; }
        .hand { position: absolute; width: 3px; background: #9BA5B4; bottom: 50%; left: calc(50% - 1.5px); transform-origin: bottom; }
        .hour { height: 25px; animation: spin 3s linear infinite; }
        .minute { height: 35px; animation: spin 0.75s linear infinite; }

        /* --- NOTIFICATION --- */
        #installerNotif {
            position: fixed; top: 15px; right: -350px;
            width: 280px; background: white; border-radius: 12px;
            padding: 12px; border-left: 6px solid #CFBCFF; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); transition: 0.6s cubic-bezier(0.22, 1, 0.36, 1); z-index: 1000;
        }
        #installerNotif.show { right: 15px; }
        .dl-btn { 
            background: #CFBCFF; color: #6A5D8A; border: none; padding: 10px; 
            border-radius: 8px; width: 100%; cursor: pointer; margin-top: 8px; 
            font-weight: bold; transition: 0.2s ease; box-shadow: 0 3px 0px #B2A0E0;
        }
        @keyframes dlPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); box-shadow: 0 0 15px rgba(207, 188, 255, 0.6); }
            100% { transform: scale(1); }
        }
        .dl-btn.glow-pulse { animation: dlPulse 1.5s infinite ease-in-out; border: 2px solid white; }

        /* --- INSTALLER OVERLAY --- */
        #installOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(207, 188, 255, 0.8); backdrop-filter: blur(8px);
            display: none; justify-content: center; align-items: center; z-index: 2000;
        }
        .install-card { background: white; padding: 30px; border-radius: 20px; text-align: center; }
        .progress-bar { width: 200px; height: 10px; background: #eee; border-radius: 10px; overflow: hidden; margin-top: 15px; }
        .progress-fill { width: 0%; height: 100%; background: #CFBCFF; transition: width 1s linear; }

        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <audio id="ringtone" loop><source src="ringtone.mp3" type="audio/mpeg"></audio>
    <audio id="clockSfx"><source src="clock.mp3" type="audio/mpeg"></audio>
    <audio id="msgSfx"><source src="jenmsg.mp3" type="audio/mpeg"></audio>

    <div id="installOverlay">
        <div class="install-card">
            <p style="font-weight: 700; color: #6A5D8A; margin-bottom: 15px;">Installing Friendzy...</p>
            <div class="progress-bar"><div class="progress-fill" id="fill"></div></div>
        </div>
    </div>

    <div class="desktop-icons">
        <div class="icon-item"><div class="icon-box icon-photos">üì∑</div><span class="icon-label">Photos</span></div>
        <div class="icon-item"><div class="icon-box icon-chrome">üåê</div><span class="icon-label">Chrome</span></div>
    </div>

    <div id="installerNotif">
        <div style="font-weight: 700; color: #6A5D8A;">üì© Sent from Jen</div>
        <div style="font-size: 13px; color: #9BA5B4;">Friendzy Installer - Setup.exe</div>
        <button id="downloadBtn" class="dl-btn" onclick="startInstall()">Download Now</button>
    </div>

    <div class="call-window" id="mainCallWindow">
        <div class="window-header">
            <div class="window-controls">
                <div class="control red"></div>
                <div class="control yellow"></div>
                <div class="control green"></div>
            </div>
            <div class="header-title">System Video Call</div>
            <div style="width: 50px;"></div>
        </div>

        <div id="incomingView">
            <div class="jen-avatar"></div>
            <h3 style="color: #9BA5B4;">jenüíñüëØ‚Äç‚ôÄÔ∏è</h3>
            <div class="call-btns-row">
                <button class="btn-large decline-btn">‚úñ</button>
                <button class="btn-large accept-btn" onclick="startCall()">‚úî</button>
            </div>
        </div>

        <div id="videoView">
            <div id="jenVideoFrame"></div>
            <div class="user-mini-cam"><video id="userCam" autoplay playsinline></video></div>

            <div id="clockOverlay">
                <div class="clock"><div class="hand hour"></div><div class="hand minute"></div></div>
                <p style="margin-top: 15px; font-weight: 700; color: #9BA5B4; font-size: 14px;">3 Hours Later...</p>
            </div>

            <div class="dialogue-overlay" id="dialogueBox" onclick="nextDialogue()">
                <div class="name-tag">Jen</div>
                <p class="dialogue-text" id="convoText"></p>
                <p id="clickIndicator" style="text-align:right; font-size: 9px; color: #FFB7C5; margin-top: 8px; font-weight: bold;">Click to continue...</p>
            </div>

            <div class="video-footer">
                <button class="v-btn">üé§</button>
                <button class="v-btn">üìπ</button>
                <button class="v-btn">‚ûï</button>
                <button class="v-btn end">üìû</button>
            </div>
        </div>
    </div>

    <script>
        const script = [
            { text: "Hi bestie! I‚Äôm so glad we don‚Äôt have school today, I really needed a break‚Ä¶ How was your day?", img: "jencall1.png" },
            { type: "clock" },
            { text: "Oh my gosh, we‚Äôve been talking for three hours! My mom‚Äôs calling me for dinner, I gotta go‚Ä¶ BUT OMG WAIT!", img: "jencall2.jpg" },
            { text: "I wanted to tell you about this new app I found‚Ä¶ It‚Äôs called Friendzy! üòç", img: "jencall3.jpg" },
            { text: "It‚Äôs super cute and fun. You can meet new friends online who have the same hobbies as you!", img: "jencall4.jpg" },
            { text: "You‚Äôre always talking about wanting friends into photography, music, soccer‚Ä¶ this app actually helps you do that!", img: "jencall5.jpg" },
            { text: "I know you‚Äôre gonna love it!! üíñ", img: "jencall6.jpg" }
        ];

        let index = 0;
        let isAnimating = false;

        window.onload = () => {
            const ringtone = document.getElementById('ringtone');
            ringtone.play().catch(err => console.log("Interaction needed."));
        };

        async function startCall() {
            document.getElementById('ringtone').pause();
            const win = document.getElementById('mainCallWindow');
            const incoming = document.getElementById('incomingView');
            const video = document.getElementById('videoView');
            
            incoming.style.opacity = '0';
            win.classList.add('ongoing');
            
            setTimeout(async () => {
                incoming.style.display = 'none';
                video.style.display = 'flex';
                setTimeout(() => { video.style.opacity = '1'; }, 50);
                
                updateUI();
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    document.getElementById('userCam').srcObject = stream;
                } catch(e) { console.warn("Cam access denied."); }
            }, 400); 
        }

        function updateUI() {
            const current = script[index];
            if (current.type === "clock") {
                showClock();
            } else {
                document.getElementById('jenVideoFrame').style.backgroundImage = `url('${current.img}')`;
                document.getElementById('convoText').innerText = current.text;
            }
        }

        function showClock() {
            isAnimating = true;
            const clockSound = document.getElementById('clockSfx');
            clockSound.currentTime = 0;
            clockSound.play(); 

            document.getElementById('clockOverlay').style.display = 'flex';
            document.getElementById('dialogueBox').style.display = 'none';
            
            setTimeout(() => {
                clockSound.pause(); 
                document.getElementById('clockOverlay').style.display = 'none';
                document.getElementById('dialogueBox').style.display = 'block';
                isAnimating = false;
                index++;
                updateUI();
            }, 2000);
        }

        function nextDialogue() {
            if (isAnimating) return;
            index++;
            if (index < script.length) {
                updateUI();
            } else {
                document.getElementById('msgSfx').play();
                document.getElementById('installerNotif').classList.add('show');
                const indicator = document.getElementById('clickIndicator');
                indicator.innerText = "CLICK DOWNLOAD";
                indicator.style.color = "#CFBCFF"; 
                document.getElementById('downloadBtn').classList.add('glow-pulse');
            }
        }

        function startInstall() {
            setTimeout(() => {
                document.getElementById('installOverlay').style.display = 'flex';
                setTimeout(() => {
                    document.getElementById('fill').style.width = "100%";
                }, 100);

                setTimeout(() => {
                    document.body.style.transition = "opacity 0.8s";
                    document.body.style.opacity = "0";
                    setTimeout(() => {
                        window.location.href = 'friendzysignup.html';
                    }, 800);
                }, 1200); 
            }, 300);
        }
    </script>
</body>
</html>