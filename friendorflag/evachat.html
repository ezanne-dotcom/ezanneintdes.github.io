<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friendzy - Eva</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* RESET & BASIC SETUP */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Quicksand', sans-serif; }

        body {
            background: linear-gradient(135deg, #CFBCFF 0%, #E3D9FF 99%, #E3D9FF 100%);
            height: 100vh; display: flex; justify-content: center; align-items: center;
            overflow: hidden; position: relative;
        }

        /* --- DESKTOP ICONS --- */
        .desktop-icons { 
            position: absolute; top: 15px; left: 15px; 
            display: flex; flex-direction: column; gap: 15px; z-index: 0;
        }
        .icon-item { display: flex; flex-direction: column; align-items: center; gap: 3px; }
        .icon-box { width: 40px; height: 40px; border-radius: 10px; display: flex; justify-content: center; align-items: center; font-size: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .icon-photos { background: linear-gradient(to bottom, #FFF9E3, #FFF3B0); }
        .icon-chrome { background: linear-gradient(to bottom, #A2D2FF, #BDE0FE); }
        .icon-friendzy { background: linear-gradient(to bottom, #A2D2FF, #FFF3B0); border: 2px solid white; }
        .icon-label { color: white; font-size: 10px; font-weight: 600; text-shadow: 0 1px 3px rgba(0,0,0,0.3); }

        /* --- CHAT WINDOW --- */
        .game-window {
            width: 800px; height: 460px; background-color: #fff; border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.15); display: flex; flex-direction: column;
            overflow: hidden; position: relative; z-index: 1;
        }

        .blur-target { height: 100%; display: flex; flex-direction: column; position: relative; }
        
        #blurOverlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0); 
            backdrop-filter: blur(0px);
            transition: backdrop-filter 0.5s ease, background 0.5s ease;
            pointer-events: none;
            z-index: 50; 
            border-radius: 20px;
        }

        .overlay-active {
            background: rgba(0, 0, 0, 0.4) !important; 
            backdrop-filter: blur(15px) !important; 
            pointer-events: auto !important;
        }

        .window-header {
            height: 35px; background: linear-gradient(to right, #A2D2FF, #FFF3B0);
            display: flex; align-items: center; padding: 0 12px; justify-content: space-between;
        }

        .window-controls { display: flex; gap: 6px; width: 60px; }
        .control { width: 10px; height: 10px; border-radius: 50%; }
        .red { background-color: #FF5F56; }
        .yellow { background-color: #FFBD2E; }
        .green { background-color: #27C93F; }
        .window-title { color: #5B9BD5; font-weight: 700; font-size: 12px; letter-spacing: 1px; flex: 1; text-align: center; }

        .game-body { display: flex; flex: 1; height: calc(100% - 35px); }

        /* --- SIDEBAR --- */
        .sidebar { 
            width: 220px; 
            background: linear-gradient(180deg, #D6E9FF 0%, #BDE0FE 100%); 
            padding: 15px; color: #5B9BD5; 
        }
        .avatar-circle { 
            width: 50px; height: 50px; background-color: #FFF3B0; 
            border-radius: 50%; margin: 0 auto 10px; display: flex; 
            justify-content: center; align-items: center; font-size: 24px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        
        .nav-btn {
            background: rgba(255, 255, 255, 0.5); border: none; width: 100%;
            padding: 10px 15px; border-radius: 12px; color: #5B9BD5;
            font-size: 12px; font-weight: 600; cursor: pointer; text-align: left;
            display: flex; align-items: center; gap: 8px; margin-bottom: 5px;
        }
        .nav-btn.active { background-color: #FFF3B0; color: #5B9BD5; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        .sub-menu { margin-left: 15px; border-left: 2px solid #5B9BD5; padding-left: 10px; margin-bottom: 10px; }
        .sub-item { background: #FFF3B0; color: #5B9BD5; padding: 6px; border-radius: 8px; font-weight: 700; font-size: 11px; }

        /* --- CHAT AREA --- */
        .chat-area { flex: 1; display: flex; flex-direction: column; position: relative; background-color: #ffffff; }
        .chat-header { padding: 12px; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 10px; justify-content: space-between; }
        .chat-messages { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; background: #fafafa; }
        
        /* FLAG STYLES */
        #flagBtn { 
            font-size: 18px; cursor: default; opacity: 0.1; transition: all 0.3s ease; 
            padding: 5px; border-radius: 8px; display: flex; align-items: center; justify-content: center;
        }
        #flagBtn.active { opacity: 1; cursor: pointer; }
        #flagBtn.active:hover { background: rgba(255, 95, 86, 0.1); transform: scale(1.1); }
        #flagBtn.pulse { animation: flagPulse 1s infinite alternate; }
        
        @keyframes flagPulse {
            0% { transform: scale(1); filter: drop-shadow(0 0 0px rgba(255,95,86,0)); }
            100% { transform: scale(1.2); filter: drop-shadow(0 0 8px rgba(255,95,86,0.8)); }
        }

        /* PULSING LINK */
        .sus-link.pulse-link { animation: linkPulse 1s infinite alternate; display: inline-block; }
        @keyframes linkPulse {
            0% { color: #5B9BD5; transform: scale(1); }
            100% { color: #3a7db8; transform: scale(1.02); text-shadow: 0 0 5px rgba(91, 155, 213, 0.4); }
        }

        .bubble { 
            max-width: 75%; padding: 8px 12px; border-radius: 15px; font-size: 13px; 
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            transform-origin: left bottom; line-height: 1.4;
        }
        .bubble.user { align-self: flex-end; background: #A2D2FF; color: white; transform-origin: right bottom; }
        .bubble.eva { align-self: flex-start; background: white; border: 1px solid #eee; color: #444; }
        
        @keyframes popIn {
            0% { opacity: 0; transform: scale(0.8) translateY(10px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }

        .sus-link { color: #5B9BD5; text-decoration: underline; cursor: pointer; font-weight: 700; transition: color 0.2s; }
        .sus-link:hover { color: #3a7db8; background: rgba(162, 210, 255, 0.1); border-radius: 4px; }

        .status-msg { 
            font-size: 11px; color: #5B9BD5; margin: 5px 15px; font-weight: 700; 
            min-height: 15px; opacity: 0; transition: opacity 0.5s ease;
        }
        .status-visible { opacity: 1; }

        .chat-input-wrap { padding: 12px; border-top: 1px solid #eee; display: flex; gap: 10px; }
        .chat-input { flex: 1; padding: 8px 15px; border: 2px solid #FFF3B0; border-radius: 20px; outline: none; font-size: 13px; }
        .chat-input:disabled { background-color: #fdfdfd; cursor: not-allowed; border-color: #eee; }
        
        .send-btn { background: #A2D2FF; border: none; width: 35px; height: 35px; border-radius: 50%; color: white; cursor: pointer; transition: transform 0.1s ease; display: flex; align-items: center; justify-content: center; }
        .send-btn:active:not(:disabled) { transform: scale(0.9); background: #89C2F7; }
        .send-btn:disabled { background: #eee; cursor: not-allowed; }

        /* --- NOTIFICATIONS --- */
        #debriefOverlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; justify-content: center; align-items: center; z-index: 10001;
        }
        .alert-box {
            width: 520px; background: white; border-radius: 30px;
            overflow: hidden; box-shadow: 0 15px 45px rgba(0,0,0,0.4);
            animation: alertPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transition: height 0.4s cubic-bezier(0.23, 1, 0.32, 1), width 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            position: relative; display: flex; flex-direction: column;
            min-height: 200px;
        }
        .debrief-page { 
            width: 100%; 
            padding: 25px 0 0 0; 
            display: none; 
            opacity: 0; 
            transition: opacity 0.4s ease, transform 0.4s cubic-bezier(0.23, 1, 0.32, 1); 
        }
        .debrief-page.active { display: block; opacity: 1; transform: translateX(0); }
        
        .slide-right { transform: translateX(30px); }
        .slide-left { transform: translateX(-30px); }

        .alert-content { padding: 0 30px 20px 30px; }
        .alert-title { font-weight: 700; color: #000; font-size: 17px; display: block; margin-bottom: 15px; text-align: center; }
        .alert-msg { font-size: 13px; color: #444; line-height: 1.6; text-align: center; }
        
        .progress-checker { font-size: 11px; color: #ccc; font-weight: 700; margin-top: 15px; text-align: center;}
        
        /* Fixed bottom button area */
        .alert-actions { 
            display: flex; 
            border-top: 1px solid #f0f0f0; 
            margin-top: auto; 
            width: 100%;
            background: #fff;
        }
        .alert-btn { 
            flex: 1; padding: 18px; border: none; background: transparent; 
            font-size: 14px; cursor: pointer; transition: 0.2s; 
            color: #aaa; border-right: 1px solid #f0f0f0; 
        }
        .alert-btn:last-child { border-right: none; color: #5B9BD5; font-weight: 600; }
        .alert-btn.btn-danger { color: #FF5F56 !important; font-weight: 700 !important; }
        .alert-btn:active { background: #f9f9f9; }
        .alert-btn.disabled { color: #eee; cursor: not-allowed; }
        .alert-btn.back-active { color: #666; font-weight: 600; }

        @keyframes alertPop { 0% { transform: scale(0.9); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

        /* --- MINIGAME --- */
        #gameOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 9999; display: none;
            flex-direction: column; align-items: center; justify-content: center;
            color: white; overflow: hidden;
        }
        .urgency-header { display: flex; flex-direction: column; align-items: center; gap: 5px; z-index: 20; pointer-events: none; }
        #urgencyText { 
            font-size: 38px; font-weight: 900; color: #FF5F56; 
            text-shadow: 0 0 10px rgba(255, 95, 86, 0.5);
            animation: pulseGlow 0.8s infinite alternate; 
        }
        #instructionText { font-size: 16px; font-weight: 600; color: #FFF3B0; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }
        #timer { font-size: 64px; font-weight: 900; color: white; margin-bottom: 20px; }

        @keyframes pulseGlow { 
            0% { transform: scale(1); text-shadow: 0 0 5px #FF5F56; } 
            100% { transform: scale(1.05); text-shadow: 0 0 25px #FF5F56, 0 0 40px #FF5F56; } 
        }

        .hacker { font-size: 60px; position: absolute; z-index: 10; pointer-events: none; transition: 0.3s; }
        .data-file { position: absolute; display: flex; flex-direction: column; align-items: center; gap: 8px; transition: transform 0.1s linear; }
        .secure-btn { background: #FF5F56; border: none; padding: 6px 14px; color: white; border-radius: 50px; cursor: pointer; font-size: 11px; font-weight: 700; box-shadow: 0 4px #d44b43; transition: 0.2s;}
        .secure-btn.locked { background: #27C93F; box-shadow: 0 4px #1e9b31; pointer-events: none; }
        .secure-success { color: #27C93F; font-size: 40px; font-weight: 900; animation: glowOut 1s forwards; display: none; }
        @keyframes glowOut { 0% { transform: scale(0.5); opacity: 0; } 50% { opacity: 1; } 100% { transform: scale(1.5); opacity: 0; } }
    </style>
</head>
<body>

    <audio id="alarmSnd" src="alarm.mp3" loop></audio>
    <audio id="successSnd" src="systemsecured.mp3"></audio>
    <audio id="evaMsgSnd" src="friendzymsg.mp3"></audio>

    <div class="desktop-icons">
        <div class="icon-item"><div class="icon-box icon-photos">üì∑</div><span class="icon-label">Photos</span></div>
        <div class="icon-item"><div class="icon-box icon-chrome">üåê</div><span class="icon-label">Chrome</span></div>
        <div class="icon-item" id="appIcon">
            <div class="icon-box icon-friendzy">‚ú®</div>
            <span class="icon-label">Friendzy</span>
        </div>
    </div>

    <div class="game-window">
        <div class="blur-target">
            <div id="blurOverlay"></div>
            <div class="window-header">
                <div class="window-controls">
                    <div class="control red"></div><div class="control yellow"></div><div class="control green"></div>
                </div>
                <div class="window-title">‚ú® Friendzy - Chatting with Eva ‚ú®</div>
                <div style="width: 60px;"></div>
            </div>
            <div class="game-body">
                <div class="sidebar">
                    <div class="avatar-circle">ü§†</div>
                    <div id="profileName" style="font-weight:700; text-align:center; font-size: 14px; margin-bottom: 25px;">Guest</div>
                    <button class="nav-btn active"><span>üì©</span> Chat Requests</button>
                    <div class="sub-menu"><div class="sub-item">ü©∞ Eva</div></div>
                    <button class="nav-btn"><span>üí¨</span> Friend Chats</button>
                </div>
                <div class="chat-area">
                    <div class="chat-header">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="font-size: 24px;">ü©∞</div>
                            <div>
                                <div style="font-weight:700; font-size: 14px; color: #5B9BD5;">Eva</div>
                                <div style="font-size:10px;color:#888;">You both like Music</div>
                            </div>
                        </div>
                        <div id="flagBtn" title="Report User" onclick="flagEarly()">üö©</div>
                    </div>
                    <div class="chat-messages" id="chatBox"></div>
                    <div class="status-msg" id="statusLine"></div>
                    <div class="chat-input-wrap">
                        <input type="text" class="chat-input" id="userInput" placeholder="Type a message..." onkeydown="if(event.key==='Enter') sendMessage()" disabled>
                        <button class="send-btn" id="sendBtn" onclick="sendMessage()" disabled>‚ûî</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="debriefOverlay">
            <div class="alert-box" id="alertBox">
                <div id="pSuccess" class="debrief-page">
                    <div class="alert-content">
                        <span class="alert-title">üåü Excellent Instincts!</span>
                        <div class="alert-msg">
                            That ‚Äúexclusive‚Äù link was actually sent by an AI-generated scam account designed to target your interests. It was a gateway for malware.<br><br>
                            By flagging the user instead of clicking, you protected your data from being stolen.<br><br>
                            Curious what would have happened if you clicked?
                        </div>
                    </div>
                    <div class="alert-actions">
                        <button class="alert-btn disabled">Cancel</button>
                        <button class="alert-btn btn-danger" onclick="retryEncounter()">Retry</button>
                    </div>
                </div>

                <div id="p1" class="debrief-page">
                    <div class="alert-content">
                        <span class="alert-title">‚ö†Ô∏è DEBRIEF ‚Äì What Just Happened?</span>
                        <div class="alert-msg">
                            When you downloaded that file, malware was installed.<br>
                            The message encouraging you to download it wasn‚Äôt from a real friend ‚Äî<br><br>
                            it was likely an <b>AI-generated scam account</b> designed to target your interests.<br>
                            AI can study your profile, hobbies, and conversations to create messages that feel personal and trustworthy.
                        </div>
                        <div class="progress-checker">1 / 4</div>
                    </div>
                    <div class="alert-actions">
                        <button class="alert-btn disabled">Cancel</button>
                        <button class="alert-btn" onclick="goToPage(2)">Learn More</button>
                    </div>
                </div>

                <div id="p2" class="debrief-page">
                    <div class="alert-content">
                        <span class="alert-title">üïµÔ∏è Real-time Threat</span>
                        <div class="alert-msg">
                            You might not notice anything at first‚Ä¶<br><br>
                            but your device is already compromised, it can:<br>
                            ‚Ä¢ Download your private photos and files<br>
                            ‚Ä¢ Record what you type, including passwords<br>
                            ‚Ä¢ Access your email and social media accounts<br>
                            ‚Ä¢ Access your bank details and move money
                        </div>
                        <div class="progress-checker">2 / 4</div>
                    </div>
                    <div class="alert-actions">
                        <button class="alert-btn back-active" onclick="goToPage(1, true)">Back</button>
                        <button class="alert-btn" onclick="goToPage(3)">Learn More</button>
                    </div>
                </div>

                <div id="p3" class="debrief-page">
                    <div class="alert-content">
                        <span class="alert-title">üß† Real-Life Impact</span>
                        <div class="alert-msg">
                            If this happens in real life, the damage is serious:<br>
                            ‚Ä¢ Someone could impersonate you<br>
                            ‚Ä¢ Friends get scam messages from ‚Äúyou‚Äù<br>
                            ‚Ä¢ Data could be leaked or sold online<br>
                            ‚Ä¢ Money or accounts permanently lost
                        </div>
                        <div class="progress-checker">3 / 4</div>
                    </div>
                    <div class="alert-actions">
                        <button class="alert-btn back-active" onclick="goToPage(2, true)">Back</button>
                        <button class="alert-btn" onclick="goToPage(4)">Learn More</button>
                    </div>
                </div>

                <div id="p4" class="debrief-page">
                    <div class="alert-content">
                        <span class="alert-title">‚úÖ What You Should Do Instead</span>
                        <div class="alert-msg">
                            ‚Ä¢ Only use official app stores<br>
                            ‚Ä¢ Avoid leaked or pirated content<br>
                            ‚Ä¢ Don‚Äôt click unknown links from strangers<br>
                            ‚Ä¢ Turn on two-factor authentication<br>
                            ‚Ä¢ Report suspicious users immediately
                        </div>
                        <div class="progress-checker">4 / 4</div>
                    </div>
                    <div class="alert-actions">
                        <button class="alert-btn back-active" onclick="goToPage(3, true)">Back</button>
                        <button class="alert-btn btn-danger" onclick="window.location.href='friendzyhome2.html'">Flag User</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="gameOverlay">
        <div class="urgency-header">
            <div id="urgencyText">MALWARE INSTALLING</div>
            <div id="instructionText">CLICK ON YOUR FILES TO SECURE THEM BEFORE THEY GET HACKED!</div>
            <div id="timer">15s</div>
        </div>
        <div class="secure-success" id="successGlow">SYSTEM SECURED</div>
        <div id="fileContainer"></div>
        <div class="hacker" id="hacker" style="top: 80%; left: 80%;">üëæ</div>
        <button id="retryBtn" style="display:none; z-index:30; background:#A2D2FF; color:white; border:none; padding:15px 30px; border-radius:12px; font-weight:700; cursor:pointer;" onclick="startMiniGame()">Try Again</button>
    </div>

    <script>
        const chatBox = document.getElementById('chatBox');
        const statusLine = document.getElementById('statusLine');
        const blurOverlay = document.getElementById('blurOverlay');
        const alertBox = document.getElementById('alertBox');
        const alarmSnd = document.getElementById('alarmSnd');
        const successSnd = document.getElementById('successSnd');
        const evaMsgSnd = document.getElementById('evaMsgSnd');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const flagBtn = document.getElementById('flagBtn');
        
        let step = 0;
        let securedCount = 0;
        const totalFiles = 10;
        let gameActive = false;
        let canFlag = false;

        const filePositions = [
            {l: 12, t: 15}, {l: 35, t: 13}, {l: 65, t: 15}, {l: 88, t: 18},
            {l: 15, t: 45}, {l: 85, t: 45},
            {l: 12, t: 80}, {l: 35, t: 78}, {l: 65, t: 80}, {l: 88, t: 78}
        ];

        function addMsg(t, s) {
            const b = document.createElement('div');
            b.className = `bubble ${s}`;
            b.innerHTML = t;
            chatBox.appendChild(b);
            chatBox.scrollTop = chatBox.scrollHeight;
            if(s === 'eva') {
                evaMsgSnd.currentTime = 0;
                evaMsgSnd.play().catch(() => {});
            }
            return b;
        }

        function updateStatus(text) {
            statusLine.classList.remove('status-visible');
            setTimeout(() => {
                statusLine.innerText = text;
                if(text) statusLine.classList.add('status-visible');
            }, 300);
        }

        window.onload = () => {
            const savedName = localStorage.getItem('friendzy_name') || "Guest";
            document.getElementById('profileName').innerText = savedName;

            addMsg("hi there!", "eva");
            setTimeout(() => {
                addMsg("i see u like music, who do u listen to!", "eva");
                userInput.disabled = false;
                sendBtn.disabled = false;
                updateStatus("Type and send your favourite singer");
            }, 1000);
        };

        function sendMessage() {
            const i = document.getElementById('userInput');
            if (!i.value.trim() || step > 0) return;
            const artist = i.value;
            addMsg(artist, "user");
            
            i.value = "";
            i.disabled = true;
            sendBtn.disabled = true;
            
            updateStatus("");
            step = 1;
            setTimeout(() => {
                updateStatus("Eva is typing...");
                setTimeout(() => {
                    updateStatus("");
                    addMsg("me too! psst...", "eva");
                    setTimeout(() => {
                        const linkName = artist.replace(/\s+/g, '').toLowerCase();
                        addMsg(`i have the link to their unreleased album!<br><span id="malwareLink" class="sus-link" onclick="startMiniGame()">http://friendzy.io/dl/${linkName}-exclusive.exe</span>`, "eva");
                        
                        document.getElementById('malwareLink').classList.add('pulse-link');
                        updateStatus("Flag user (top-right) or click link to download");
                        flagBtn.classList.add('active', 'pulse');
                        canFlag = true;

                    }, 800);
                }, 1500);
            }, 800);
        }

        function flagEarly() {
            if(!canFlag) return;
            successSnd.currentTime = 0;
            successSnd.play().catch(() => {});
            blurOverlay.classList.add('overlay-active');
            document.getElementById('debriefOverlay').style.display = 'flex';
            
            document.querySelectorAll('.debrief-page').forEach(p => p.classList.remove('active'));
            
            const successPage = document.getElementById('pSuccess');
            successPage.style.display = 'block';
            alertBox.style.width = "400px";
            
            setTimeout(() => {
                successPage.classList.add('active');
                alertBox.style.height = successPage.offsetHeight + 'px';
            }, 50);
        }

        function retryEncounter() {
            blurOverlay.classList.remove('overlay-active');
            document.getElementById('debriefOverlay').style.display = 'none';
        }

        function startMiniGame() {
            gameActive = true;
            securedCount = 0;
            alarmSnd.currentTime = 0;
            alarmSnd.play().catch(() => {});
            
            document.getElementById('urgencyText').innerText = "MALWARE INSTALLING";
            document.getElementById('gameOverlay').style.display = 'flex';
            document.getElementById('debriefOverlay').style.display = 'none';
            document.getElementById('successGlow').style.display = 'none';
            document.querySelector('.urgency-header').style.display = 'flex';
            document.getElementById('hacker').style.display = 'block';
            document.getElementById('retryBtn').style.display = 'none';
            blurOverlay.classList.remove('overlay-active');
            
            const container = document.getElementById('fileContainer');
            container.innerHTML = "";
            const icons = ['üñºÔ∏è', 'üîë', 'üí≥', 'üìÇ', 'üì±', '‚úâÔ∏è', 'üéµ', 'üîí', 'üì∏', 'üí∞'];
            
            filePositions.forEach((pos, idx) => {
                const f = document.createElement('div');
                f.className = "data-file";
                f.style.left = pos.l + "%";
                f.style.top = pos.t + "%";
                f.innerHTML = `<span style="font-size:32px">${icons[idx]}</span> <button class="secure-btn" onclick="secureFile(this)">UNPROTECTED</button>`;
                container.appendChild(f);
                
                const jiggle = () => {
                    if(!gameActive) return;
                    f.style.transform = `translate(${Math.random() * 20 - 10}px, ${Math.random() * 20 - 10}px)`;
                    setTimeout(jiggle, 80); 
                };
                jiggle();
            });

            let timeLeft = 15; 
            const timerEl = document.getElementById('timer');
            const hacker = document.getElementById('hacker');
            
            const gameInterval = setInterval(() => {
                timeLeft--;
                timerEl.innerText = timeLeft + "s";
                hacker.style.top = Math.random() * 80 + "%";
                hacker.style.left = Math.random() * 80 + "%";

                if (timeLeft <= 0 || securedCount === totalFiles) {
                    clearInterval(gameInterval);
                    gameActive = false;
                    alarmSnd.pause();
                    if (securedCount < totalFiles) {
                        document.getElementById('urgencyText').innerText = "SYSTEM COMPROMISED";
                        document.getElementById('retryBtn').style.display = 'block';
                    } else {
                        triggerSuccess();
                    }
                }
            }, 1000);
        }

        function secureFile(btn) {
            btn.innerText = "SECURED";
            btn.classList.add('locked');
            securedCount++;
        }

        function triggerSuccess() {
            successSnd.currentTime = 0;
            successSnd.play().catch(() => {});
            document.querySelector('.urgency-header').style.display = 'none';
            document.getElementById('hacker').style.display = 'none';
            document.getElementById('fileContainer').innerHTML = "";
            document.getElementById('successGlow').style.display = 'block';
            
            setTimeout(() => {
                document.getElementById('gameOverlay').style.display = 'none';
                blurOverlay.classList.add('overlay-active'); 
                document.getElementById('debriefOverlay').style.display = 'flex';
                goToPage(1);
            }, 1500);
        }

        function goToPage(targetNum, isBack = false) {
            const nextEl = document.getElementById('p' + targetNum);
            let targetWidth = "520px";
            if(targetNum >= 2) targetWidth = "380px";
            
            document.querySelectorAll('.debrief-page').forEach(p => {
                p.classList.remove('active');
                p.style.display = 'none';
            });
            
            nextEl.style.display = 'block';
            nextEl.classList.remove('slide-right', 'slide-left');
            nextEl.classList.add(isBack ? 'slide-left' : 'slide-right');
            
            alertBox.style.width = targetWidth;

            setTimeout(() => {
                nextEl.classList.add('active');
                alertBox.style.height = nextEl.offsetHeight + 'px';
            }, 50);
        }
    </script>
</body>
</html>