<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friendzy - Jay</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* RESET & BASIC SETUP */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Quicksand', sans-serif; }

        body {
            background: linear-gradient(135deg, #CFBCFF 0%, #E3D9FF 99%, #E3D9FF 100%);
            height: 100vh; display: flex; justify-content: center; align-items: center;
            overflow: hidden; position: relative;
        }

        /* --- DESKTOP ICONS --- */
        .desktop-icons { 
            position: absolute; top: 15px; left: 15px; 
            display: flex; flex-direction: column; gap: 15px; z-index: 0;
        }
        .icon-item { display: flex; flex-direction: column; align-items: center; gap: 3px; }
        .icon-box { width: 40px; height: 40px; border-radius: 10px; display: flex; justify-content: center; align-items: center; font-size: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .icon-photos { background: linear-gradient(to bottom, #FFF9E3, #FFF3B0); }
        .icon-chrome { background: linear-gradient(to bottom, #A2D2FF, #BDE0FE); }
        .icon-friendzy { background: linear-gradient(to bottom, #A2D2FF, #FFF3B0); border: 2px solid white; }
        .icon-label { color: white; font-size: 10px; font-weight: 600; text-shadow: 0 1px 3px rgba(0,0,0,0.3); }

        /* --- CHAT WINDOW --- */
        .game-window {
            width: 800px; height: 460px; background-color: #fff; border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.15); display: flex; flex-direction: column;
            overflow: hidden; position: relative; z-index: 1;
        }

        .window-header {
            height: 35px; background: linear-gradient(to right, #A2D2FF, #FFF3B0);
            display: flex; align-items: center; padding: 0 12px; justify-content: space-between;
        }

        .window-controls { display: flex; gap: 6px; width: 60px; }
        .control { width: 10px; height: 10px; border-radius: 50%; }
        .red { background-color: #FF5F56; }
        .yellow { background-color: #FFBD2E; }
        .green { background-color: #27C93F; }
        .window-title { color: #5B9BD5; font-weight: 700; font-size: 12px; letter-spacing: 1px; flex: 1; text-align: center; }

        .game-body { display: flex; flex: 1; height: calc(100% - 35px); position: relative; }

        .sidebar { 
            width: 220px; 
            background: linear-gradient(180deg, #D6E9FF 0%, #BDE0FE 100%); 
            padding: 15px; color: #5B9BD5; 
        }
        .avatar-circle { 
            width: 50px; height: 50px; background-color: #FFF3B0; 
            border-radius: 50%; margin: 0 auto 10px; display: flex; 
            justify-content: center; align-items: center; font-size: 24px; 
        }
        
        .nav-btn {
            background: rgba(255, 255, 255, 0.5); border: none; width: 100%;
            padding: 10px 15px; border-radius: 12px; color: #5B9BD5;
            font-size: 12px; font-weight: 600; cursor: pointer; text-align: left;
            display: flex; align-items: center; gap: 8px; margin-bottom: 5px;
        }
        .nav-btn.active { background-color: #FFF3B0; color: #5B9BD5; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        .sub-menu { margin-left: 15px; border-left: 2px solid #5B9BD5; padding-left: 10px; margin-bottom: 10px; }
        .sub-item { background: #FFF3B0; color: #5B9BD5; padding: 6px; border-radius: 8px; font-weight: 700; font-size: 11px; }

        .chat-area { flex: 1; display: flex; flex-direction: column; position: relative; background-color: #ffffff; }
        
        .chat-header { 
            padding: 10px 15px; border-bottom: 1px solid #eee; 
            display: flex; align-items: center; justify-content: space-between; height: 55px;
        }
        
        .header-info { display: flex; align-items: center; gap: 12px; }
        .header-emoji { font-size: 22px; display: flex; align-items: center; }
        .header-text { display: flex; flex-direction: column; }
        .header-name { font-weight: 700; font-size: 14px; color: #5B9BD5; line-height: 1.2; }
        .header-subtext { font-size: 10px; color: #888; }

        #flagBtn { font-size: 18px; opacity: 0.1; cursor: default; padding: 5px; display: flex; align-items: center; justify-content: center; }

        .chat-messages { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; background: #fafafa; }
        
        .bubble { 
            max-width: 75%; padding: 8px 12px; border-radius: 15px; font-size: 13px; 
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            line-height: 1.4;
        }
        .bubble.user { align-self: flex-end; background: #A2D2FF; color: white; transform-origin: right bottom; }
        .bubble.jay { align-self: flex-start; background: white; border: 1px solid #eee; color: #444; transform-origin: left bottom; }
        
        @keyframes popIn {
            0% { opacity: 0; transform: scale(0.8) translateY(10px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }

        .status-msg { 
            font-size: 11px; color: #5B9BD5; margin: 5px 15px; font-weight: 700; 
            min-height: 15px; opacity: 0; transition: opacity 0.3s ease;
        }
        .status-visible { opacity: 1; }

        .chat-input-wrap { padding: 12px; border-top: 1px solid #eee; display: flex; gap: 10px; }
        .chat-input { flex: 1; padding: 8px 15px; border: 2px solid #FFF3B0; border-radius: 20px; outline: none; font-size: 13px; background: #fff; cursor: default; }
        
        .send-btn { background: #A2D2FF; border: none; width: 35px; height: 35px; border-radius: 50%; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .send-btn:disabled { background: #eee; cursor: not-allowed; }

        /* --- NOTIFICATIONS --- */
        .overlay-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; justify-content: center; align-items: center; z-index: 10001;
            background: rgba(0,0,0,0.1); backdrop-filter: blur(5px);
        }
        .alert-box {
            width: 440px; background: white; border-radius: 30px;
            overflow: hidden; box-shadow: 0 15px 45px rgba(0,0,0,0.4);
            animation: alertPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transition: height 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            position: relative; display: flex; flex-direction: column;
        }
        .debrief-page { 
            width: 100%; 
            padding: 25px 0 0 0; 
            display: none; 
            opacity: 0; 
            position: absolute;
            top: 0;
            left: 0;
            transition: opacity 0.4s ease, transform 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        }
        .debrief-page.active { 
            display: block; 
            opacity: 1; 
            transform: translateX(0); 
            position: relative; /* Only active page takes up space for height transition */
        }
        
        /* Transition Animations */
        .slide-out-left { transform: translateX(-100px); opacity: 0; pointer-events: none; }
        .slide-out-right { transform: translateX(100px); opacity: 0; pointer-events: none; }
        .slide-in-left { transform: translateX(-100px); opacity: 0; }
        .slide-in-right { transform: translateX(100px); opacity: 0; }

        .alert-content { padding: 0 30px 20px 30px; }
        .alert-title { font-weight: 700; color: #000; font-size: 17px; display: block; margin-bottom: 15px; text-align: center; }
        .alert-msg { font-size: 13px; color: #000; line-height: 1.6; text-align: center; }
        
        .progress-checker { font-size: 11px; color: #ccc; font-weight: 700; margin-top: 15px; text-align: center;}
        
        .alert-actions { 
            display: flex; 
            border-top: 1px solid #f0f0f0; 
            margin-top: auto; 
            width: 100%;
            background: #fff;
        }
        .alert-btn { 
            flex: 1; padding: 18px; border: none; background: transparent; 
            font-size: 14px; cursor: pointer; transition: 0.2s; 
            color: #aaa; border-right: 1px solid #f0f0f0; 
        }
        .alert-btn:last-child { border-right: none; color: #5B9BD5; font-weight: 600; }
        .alert-btn.btn-danger { color: #FF5F56 !important; font-weight: 700 !important; }
        .alert-btn:active { background: #f9f9f9; }
        .alert-btn.disabled { color: #eee; cursor: not-allowed; }
        .alert-btn.back-active { color: #666; font-weight: 600; }

        @keyframes alertPop { 0% { transform: scale(0.9); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

        .debrief-bullets { text-align: center; display: inline-block; margin-top: 10px; list-style: none; width: 100%; }
        .debrief-bullets li { margin-bottom: 10px; font-size: 13px; color: #000; position: relative; }

        /* --- GAME CONTAINER --- */
        #gameLayer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; z-index: 2000;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
        }
        #gameCanvas { width: 100%; height: 100%; display: block; cursor: pointer; }

    </style>
</head>
<body>

    <audio id="msgSnd" src="friendzymsg.mp3"></audio>
    <audio id="typeSnd" src="typing.mp3" loop></audio>
    <audio id="notifSnd" src="friendzynotif.mp3"></audio>
    <audio id="securedSnd" src="systemsecured.mp3"></audio>
    <audio id="loseSnd" src="lose.mp3"></audio>

    <div class="desktop-icons">
        <div class="icon-item"><div class="icon-box icon-photos">üì∑</div><span class="icon-label">Photos</span></div>
        <div class="icon-item"><div class="icon-box icon-chrome">üåê</div><span class="icon-label">Chrome</span></div>
        <div class="icon-item"><div class="icon-box icon-friendzy">‚ú®</div><span class="icon-label">Friendzy</span></div>
    </div>

    <div class="game-window" id="mainContainer">
        <div class="window-header">
            <div class="window-controls">
                <div class="control red"></div><div class="control yellow"></div><div class="control green"></div>
            </div>
            <div class="window-title">‚ú® Friendzy - Chatting with Jay ‚ú®</div>
            <div style="width: 60px;"></div>
        </div>
        <div class="game-body">
            <div class="sidebar">
                <div class="avatar-circle">ü§†</div>
                <div id="profileName" style="font-weight:700; text-align:center; font-size: 14px; margin-bottom: 25px;">Guest</div>
                <button class="nav-btn active"><span>üì©</span> Chat Requests</button>
                <div class="sub-menu"><div class="sub-item">üì∏ Jay</div></div>
                <button class="nav-btn"><span>üí¨</span> Friend Chats</button>
            </div>

            <div class="chat-area">
                <div class="chat-header">
                    <div class="header-info">
                        <div class="header-emoji">üì∏</div>
                        <div class="header-text">
                            <span class="header-name">Jay</span>
                            <span class="header-subtext">You both like Photography</span>
                        </div>
                    </div>
                    <div id="flagBtn">üö©</div>
                </div>
                <div class="chat-messages" id="chatBox"></div>
                <div class="status-msg" id="statusLine"></div>
                <div class="chat-input-wrap">
                    <input type="text" class="chat-input" id="userInput" readonly>
                    <button class="send-btn" id="sendBtn" onclick="sendMessage()" disabled>‚ûî</button>
                </div>
            </div>

            <div id="gameLayer">
                <canvas id="gameCanvas"></canvas>
            </div>
        </div>

        <div id="winDebrief" class="overlay-screen">
            <div class="alert-box" id="debriefContainer">
                <div class="debrief-page active" id="step1">
                    <div class="alert-content">
                        <span class="alert-title">‚ö†Ô∏è DEBRIEF ‚Äì What Just Happened?</span>
                        <div class="alert-msg">The chat started friendly but quickly pushed secrecy and pressure. This is called grooming.</div>
                        <div class="alert-msg" style="margin-top:10px">Impersonaters might pretend to be a teenager or share your interests.</div>
                        <div class="alert-msg" style="margin-top:10px">The account could be an <b>AI-generated scam </b> designed to study your profile and craft messages that feel personal, attempting grooming to get something from you.</div>
                        <div class="progress-checker">1 / 4</div>
                    </div>
                    <div class="alert-actions">
                        <button class="alert-btn disabled">Cancel</button>
                        <button class="alert-btn" onclick="nextStep(2, 'next')">Learn More</button>
                    </div>
                </div>

                <div class="debrief-page" id="step2">
                    <div class="alert-content">
                        <span class="alert-title">üß† Real-Life Impact</span>
                        <div class="alert-msg">If this happens in real life, they could try to get:</div>
                        <ul class="debrief-bullets">
                            <li>‚Ä¢ Your private photos</li>
                            <li>‚Ä¢ Personal information</li>
                            <li>‚Ä¢ Access to your accounts</li>
                            <li>‚Ä¢ Leverage to manipulate or blackmail</li>
                        </ul>
                        <div class="progress-checker">2 / 4</div>
                    </div>
                    <div class="alert-actions">
                        <button class="alert-btn back-active" onclick="nextStep(1, 'back')">Back</button>
                        <button class="alert-btn" onclick="nextStep(3, 'next')">Learn More</button>
                    </div>
                </div>

                <div class="debrief-page" id="step3">
                    <div class="alert-content">
                        <span class="alert-title">üïµÔ∏è If you notice someone is trying to groom you</span>
                        <ul class="debrief-bullets">
                            <li>‚Ä¢ Refuse their requests immediately</li>
                            <li>‚Ä¢ Take screenshots as proof</li>
                            <li>‚Ä¢ Block and report the account</li>
                            <li>‚Ä¢ Tell a trusted adult or authority</li>
                        </ul>
                        <div class="progress-checker">3 / 4</div>
                    </div>
                    <div class="alert-actions">
                        <button class="alert-btn back-active" onclick="nextStep(2, 'back')">Back</button>
                        <button class="alert-btn" onclick="nextStep(4, 'next')">Learn More</button>
                    </div>
                </div>

                <div class="debrief-page" id="step4">
                    <div class="alert-content">
                        <span class="alert-title">‚úÖ Stay Safe Online</span>
                        <ul class="debrief-bullets">
                            <li>‚Ä¢ Only share personal info with people you truly trust</li>
                            <li>‚Ä¢ Don‚Äôt send private photos to strangers</li>
                            <li>‚Ä¢ Recognize manipulative messages and set boundaries</li>
                        </ul>
                        <div class="progress-checker">4 / 4</div>
                    </div>
                    <div class="alert-actions">
                        <button class="alert-btn back-active" onclick="nextStep(3, 'back')">Back</button>
                        <button class="alert-btn btn-danger" onclick="location.href='friendzyhome3.html'">Flag User</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="gameOverlay" class="overlay-screen">
            <div class="alert-box" style="width: 520px;">
                <div class="alert-content" style="padding-top:25px">
                    <span class="alert-title">üéÆ Mini-Game: Avoid the Red Flags</span>
                    <div class="alert-msg">Dodge Jay's manipulative messages to stay safe!</div>
                    <div style="background: #f9f9f9; padding: 15px; border-radius: 15px; text-align: center; font-size: 13px; color: #000; margin-top:15px">
                        ‚Ä¢ Press Click or Space to jump and stay afloat.<br>
                        ‚Ä¢ Dodge the red messages, hitting one ends the game.<br>
                        ‚Ä¢ It‚Äôs like Flappy Bird ‚Äì survive to the finish line to win!
                    </div>
                </div>
                <div class="alert-actions">
                    <button class="alert-btn" onclick="startMiniGame()" style="color:#5B9BD5; font-weight:700">START GAME</button>
                </div>
            </div>
        </div>

        <div id="collisionPopup" class="overlay-screen">
            <div class="alert-box" style="width: 380px; min-height: 180px;">
                <div class="alert-content" style="padding-top:25px; text-align: center;">
                    <span id="failTitle" class="alert-title">‚ö†Ô∏è Warning: Red Flag!</span>
                    <div id="failMsg" class="alert-msg">You were hit by a manipulative message.<br>Stay alert and try again.</div>
                </div>
                <div class="alert-actions">
                    <button class="alert-btn" onclick="startMiniGame()" style="color:#5B9BD5; font-weight:700">Restart Game</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        const chatBox = document.getElementById('chatBox');
        const statusLine = document.getElementById('statusLine');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const gameOverlay = document.getElementById('gameOverlay');
        const gameLayer = document.getElementById('gameLayer');
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const msgSnd = document.getElementById('msgSnd');
        const typeSnd = document.getElementById('typeSnd');
        const notifSnd = document.getElementById('notifSnd');
        const securedSnd = document.getElementById('securedSnd');
        const loseSnd = document.getElementById('loseSnd');

        let playerName = localStorage.getItem('friendzy_name') || "Player";
        const replyText = "Yeah! I do portraits and edits too.";

        function typeReply(text, i = 0) {
            if (i === 0) typeSnd.play().catch(() => {});
            if (i < text.length) {
                userInput.value += text.charAt(i);
                setTimeout(() => typeReply(text, i + 1), 50);
            } else {
                typeSnd.pause(); typeSnd.currentTime = 0;
                sendBtn.disabled = false;
                updateStatus("Click arrow to send reply");
            }
        }

        function addMsg(t, s) {
            const b = document.createElement('div');
            b.className = `bubble ${s}`;
            b.innerHTML = t;
            chatBox.appendChild(b);
            chatBox.scrollTop = chatBox.scrollHeight;
            if(s === 'jay') { msgSnd.currentTime = 0; msgSnd.play().catch(() => {}); }
        }

        function updateStatus(text) {
            statusLine.classList.remove('status-visible');
            setTimeout(() => {
                statusLine.innerText = text;
                if(text) statusLine.classList.add('status-visible');
            }, 200);
        }

        window.onload = () => {
            document.getElementById('profileName').innerText = playerName;
            setTimeout(() => {
                addMsg(`Hey ${playerName}! I saw you like photography too üòÑ`, "jay");
                setTimeout(() => {
                    addMsg("I mostly do street and portrait stuff. You?", "jay");
                    setTimeout(() => typeReply(replyText), 1000);
                }, 1000);
            }, 800);
        };

        function sendMessage() {
            addMsg(userInput.value, "user");
            userInput.value = "";
            sendBtn.disabled = true;
            updateStatus("");
            setTimeout(() => {
                updateStatus("Jay is typing...");
                setTimeout(() => {
                    updateStatus("");
                    addMsg("That's awesome! Maybe you can send me some of your self-portraits?", "jay");
                    setTimeout(() => { updateStatus("Notification incoming..."); }, 500);
                    setTimeout(() => {
                        notifSnd.play().catch(() => {});
                        gameOverlay.style.display = 'flex';
                    }, 3000);
                }, 1500);
            }, 1000);
        }

        let gameActive = false;
        let gameRunning = false;
        let animationId;
        const messages = [
            "Don‚Äôt tell anyone, just between us",
            "Don‚Äôt worry, only for me.",
            "You‚Äôre mature enough for this.",
            "If you really cared, you‚Äôd send it",
            "You don‚Äôt want this getting out, do you?"
        ];
        
        let avatar = { x: 100, y: 200, velocity: 0, gravity: 0.15, jump: -5.5, size: 45 };
        let obstacles = [];
        let gameSpeed = 3.2; 
        let finishLineX = 0;

        function startMiniGame() {
            gameOverlay.style.display = 'none';
            document.getElementById('collisionPopup').style.display = 'none';
            gameLayer.style.display = 'block';
            canvas.width = gameLayer.offsetWidth;
            canvas.height = gameLayer.offsetHeight;
            avatar = { x: 100, y: canvas.height/2, velocity: 0, gravity: 0.15, jump: -5.5, size: 45 };
            obstacles = [];
            const startX = canvas.width + 100;
            const horizontalGap = 500; 
            const fixedHeights = [0.2, 0.7, 0.35, 0.6, 0.25];
            
            ctx.font = "bold 14px Quicksand";
            for(let i=0; i<messages.length; i++) {
                const textWidth = ctx.measureText(messages[i]).width;
                obstacles.push({
                    x: startX + (i * horizontalGap),
                    y: canvas.height * fixedHeights[i],
                    w: textWidth + 50,
                    h: 46,
                    text: messages[i]
                });
            }
            finishLineX = startX + (messages.length * horizontalGap) + 400;
            gameActive = true;
            gameRunning = false;
            animate();
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if(gameRunning) {
                ctx.fillStyle = "#27C93F";
                ctx.fillRect(finishLineX, 0, 10, canvas.height);
                finishLineX -= gameSpeed;
            }
            ctx.fillStyle = "#3498db"; 
            ctx.beginPath();
            ctx.roundRect(avatar.x, avatar.y, avatar.size, avatar.size, 12);
            ctx.fill();
            ctx.fillStyle = "white";
            ctx.font = "bold 13px Quicksand";
            ctx.textAlign = "center";
            ctx.fillText("YOU", avatar.x + avatar.size/2, avatar.y + 28);
            
            if(gameRunning) {
                avatar.velocity += avatar.gravity;
                avatar.y += avatar.velocity;
                obstacles.forEach(ob => {
                    ob.x -= gameSpeed;
                    ctx.fillStyle = "#FF5F56";
                    ctx.beginPath();
                    ctx.roundRect(ob.x, ob.y, ob.w, ob.h, 23);
                    ctx.fill();
                    ctx.fillStyle = "white";
                    ctx.font = "bold 14px Quicksand"; 
                    ctx.textAlign = "center";
                    ctx.fillText(ob.text, ob.x + ob.w/2, ob.y + ob.h/2 + 5);
                    if (avatar.x + avatar.size - 5 > ob.x && avatar.x + 5 < ob.x + ob.w && avatar.y + avatar.size - 5 > ob.y && avatar.y + 5 < ob.y + ob.h) gameOver('msg');
                });
                if (avatar.y < 0 || avatar.y + avatar.size > canvas.height) gameOver('border');
                if (avatar.x > finishLineX) gameWin();
            } else {
                ctx.fillStyle = "#5B9BD5";
                ctx.font = "bold 16px Quicksand";
                ctx.textAlign = "center";
                ctx.fillText("Click or Space to start dodging!", canvas.width/2, canvas.height/2 + 100);
            }
            if(gameActive) animationId = requestAnimationFrame(animate);
        }

        function handleJump() { if(gameActive) { gameRunning = true; avatar.velocity = avatar.jump; } }
        window.addEventListener('keydown', (e) => { if(e.code === 'Space') handleJump(); });
        canvas.addEventListener('mousedown', handleJump);

        function gameOver(type) {
            gameActive = false;
            cancelAnimationFrame(animationId);
            loseSnd.play().catch(() => {});
            const title = document.getElementById('failTitle');
            const msg = document.getElementById('failMsg');
            if(type === 'border') {
                title.innerText = "‚ö†Ô∏è Oops!";
                msg.innerText = "You hit the border!\nStay in the middle and try again.";
            } else {
                title.innerText = "‚ö†Ô∏è Warning: Red Flag!";
                msg.innerText = "You were hit by a manipulative message.\nStay alert and try again.";
            }
            document.getElementById('collisionPopup').style.display = 'flex';
        }

        function gameWin() {
            gameActive = false;
            cancelAnimationFrame(animationId);
            securedSnd.play().catch(() => {});
            document.getElementById('winDebrief').style.display = 'flex';
            const step1 = document.getElementById('step1');
            document.getElementById('debriefContainer').style.height = step1.scrollHeight + 'px';
        }

        // DEBRIEF LOGIC
        let isTransitioning = false;
        function nextStep(stepNum, direction) {
            if (isTransitioning) return;
            
            const current = document.querySelector('.debrief-page.active');
            const target = document.getElementById('step' + stepNum);
            const container = document.getElementById('debriefContainer');

            if (!current || !target || current === target) return;

            isTransitioning = true;

            const inClass = direction === 'next' ? 'slide-in-right' : 'slide-in-left';
            const outClass = direction === 'next' ? 'slide-out-left' : 'slide-out-right';

            // 1. Prepare Target (off-screen but visible display)
            target.style.display = 'block';
            target.style.position = 'absolute';
            target.classList.remove('active', 'slide-in-left', 'slide-in-right', 'slide-out-left', 'slide-out-right');
            target.classList.add(inClass);

            // 2. Animate Height of Box
            container.style.height = target.scrollHeight + 'px';

            // 3. Trigger Slide
            setTimeout(() => {
                current.classList.add(outClass);
                current.classList.remove('active');
                
                target.classList.add('active');
                target.classList.remove(inClass);
            }, 10);

            // 4. Cleanup after 400ms (CSS duration)
            setTimeout(() => {
                current.style.display = 'none';
                current.classList.remove(outClass);
                target.style.position = 'relative'; // Allow height growth if text changes later
                isTransitioning = false;
            }, 400);
        }
    </script>
</body>
</html>